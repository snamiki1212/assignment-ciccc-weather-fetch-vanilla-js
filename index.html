<!DOCTYPE html>
<html>

<head>
  <script type="module">
    import { render } from './scripts/dom.js'

    // TODO: refactor: not to public getWeatherUrl
    import { searchWeather, getWeatherUrl, DEFAULT_CITY_NAME } from './scripts/weatherAPI.js'

    const RETRY_DURATION_MILLISECOND = 1_000 * 60 * 2;

    window.addEventListener("DOMContentLoaded", () => {
      // DOMs
      const inputDOM = document.querySelector('.input');
      const buttonDOM = document.querySelector('.button');
      const descriptionDOM = document.querySelector('.description');

      // mut params
      let lastSearchedUrl = getWeatherUrl(DEFAULT_CITY_NAME);

      // helper
      const doSearchAndRender = async (url) => {
        const params = await searchWeather(url)
        if (!params) return;

        render(descriptionDOM, params)
        lastSearchedUrl = url;
      }

      const init = () => {
        buttonDOM.addEventListener('click', async () => {
          const maybeCityName = inputDOM.value
          const url = getWeatherUrl(maybeCityName);
          doSearchAndRender(url)
        })

        setInterval(() => {
          searchWeather(lastSearchedUrl);
        }, RETRY_DURATION_MILLISECOND)

        doSearchAndRender(getWeatherUrl(DEFAULT_CITY_NAME))
      }

      init();
    });

  </script>
</head>

<body>
  <input class="input" placeholder="e.g. Vancouver" />
  <button class="button">Search</button>
  <div class="description">
    <!-- REPLACE_ME_BY_JS -->
  </div>
</body>

</html>