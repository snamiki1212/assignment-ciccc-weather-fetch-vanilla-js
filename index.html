<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import { render } from './scripts/dom.js'
    import { searchWeather, DEFAULT_CITY_NAME } from './scripts/weatherAPI.js'

    const RETRY_DURATION_MILLISECOND = 1_000 * 60 * 2;

    window.addEventListener("DOMContentLoaded", () => {
      // DOMs
      const inputDOM = document.querySelector('.input');
      const buttonDOM = document.querySelector('.button');
      const descriptionDOM = document.querySelector('.description');

      // mutate params
      let lastSearchedCityName = DEFAULT_CITY_NAME;
      let intervalHander;

      // helpers
      const doSearchAndRender = async (cityName) => {
        const params = await searchWeather(cityName)
        if (!params) return;
        render(descriptionDOM, params)
        lastSearchedCityName = cityName;
      }

      const doSetInterval = () => setInterval(() => {
        doSearchAndRender(lastSearchedCityName);
      }, RETRY_DURATION_MILLISECOND)

      const init = () => {
        doSearchAndRender(DEFAULT_CITY_NAME)
        intervalHander = doSetInterval()

        buttonDOM.addEventListener('click', async () => {
          doSearchAndRender(inputDOM.value)
          if (intervalHander) clearInterval(intervalHander)
          intervalHander = doSetInterval()
        })
      }

      init();
    });

  </script>
</head>

<body>
  <nav>
    <li><a href="index.html">TOP</a></li>
    <li><a href="current.html">CURRENT</a></li>
    <li><a href="forecast.html">FORECAST</a></li>
  </nav>

  <input class="input" placeholder="e.g. Vancouver" />
  <button class="button">Search</button>
  <div class="description">
    <!-- REPLACE_ME_BY_JS -->
  </div>
</body>

</html>